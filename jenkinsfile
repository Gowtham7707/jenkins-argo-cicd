pipeline {
    agent any 
    stages{
        stage('checkout SCM') {

            steps {
                
                script { 
                   git credentialsId: 'gitHub',
                   url: 'https://github.com/Gowtham7707/jenkins-argo-cicd.git',
                   branch: 'master'
                    
                }
            }
        }
        
       stage('Build docker image'){
            steps{
                script{
                    sh 'docker build -t gowthamc121/$JOB_NAME:v1.$BUILD_NAME .'
                }
            }
        }
        stage('Push image to hub'){
            
             environment {
                  REGISTRY_CREDENTIALS = credentials('docker')
             }
            steps{
                script{
                  docker.withRegistry('https://index.docker.io/v1/', "docker") {
               sh 'docker push gowthamc121/$JOB_NAME:v1.$BUILD_NAME'
            }
    
                }
            }
        }
    }
}
